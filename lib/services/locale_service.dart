import 'package:flutter/widgets.dart';
import 'package:hive_flutter/hive_flutter.dart';

class LocaleService {
  LocaleService._private();
  static final LocaleService instance = LocaleService._private();

  final ValueNotifier<String> languageCode = ValueNotifier<String>('en');

  Future<void> init() async {
    try {
      if (Hive.isBoxOpen('profile')) {
        final box = Hive.box('profile');
        final code = box.get('language', defaultValue: 'en') as String;
        languageCode.value = code;
      }
    } catch (_) {
      languageCode.value = 'en';
    }
  }

  void setLanguage(String code) {
    languageCode.value = code;
    try {
      if (Hive.isBoxOpen('profile')) Hive.box('profile').put('language', code);
    } catch (_) {}
  }

  String t(String key, [Map<String, String>? params]) {
    final lang = languageCode.value;
    final map = _translations[lang] ?? _translations['en']!;
    String txt = map[key] ?? key;
    if (params != null) {
      params.forEach((k, v) => txt = txt.replaceAll('{$k}', v));
    }
    return txt;
  }
}

final Map<String, Map<String, String>> _translations = {
  'en': {
    'welcome_back_check': 'Welcome back, {name}! Check your farm status.',
    'tip_water': 'Tip: Keep water clean for healthier birds.',
    'reminder_vaccination': 'Reminder: Review vaccination schedule this week.',
    'feed_management_title': 'Feed Management',
    'ai_feeding_generator': 'AI Feeding Program Generator',
    'please_select_flock_feedtype_size': 'Please select flock, feed type, and enter flock size',
    'api_key_missing': 'API key missing! Run with --dart-define=GROQ_API_KEY=...',
    'model_deprecated_msg': 'Configured model is deprecated — using fallback model.',
    'please_enter_valid_flock_size_weight': 'Please enter valid flock size and average weight',
    'feeding_program_saved': 'Feeding program saved!',
    'enter_valid_stock_amount': 'Enter valid stock amount',
    'stock_recorded': 'Stock recorded',
    'enter_valid_consumption': 'Enter valid consumption',
    'consumption_recorded': 'Consumption recorded',
    'select_flock': 'Select Flock',
    'feed_type': 'Feed Type',
    'choose_label': 'Choose {label}',
    'flock_size_hint': 'Flock Size (birds)',
    'bird_age_hint': 'Bird Age (weeks)',
    'avg_weight_hint': 'Average Weight (kg)',
    'generate_ai_program': 'Generate AI Program',
    'generating': 'Generating...',
    'quick_feed_calculator': 'Quick Feed Calculator',
    'save_program': 'Save Program',
    'save_stock': 'Save Stock',
    'save_consumption': 'Save Consumption',
    'quick_calculation': 'Quick Calculation',
    'ai_feeding_program': 'AI Feeding Program',
    'quick_feed_estimate': 'Quick Feed Estimate:',
    'please_type_question': 'Please type your question',
    'ai_busy_try_again': 'AI assistant is busy right now. Please try again in a moment.',
    'no_internet_try_again': 'No internet connection. Please check your network and try again.',
    'marketplace_title': 'Marketplace',
    'available_products': 'Available Products',
    'contact': 'Contact',
    'contacting_seller': 'Contacting seller for {name}...',
    'ai_marketplace_title': 'AI Marketplace Assistant',
    'ai_marketplace_hint': 'Ask about prices, best selling time, transport, buyers, or anything!',
    'marketplace_hint_example': 'e.g. What is a good price for broilers in Nairobi today?',
    'ai_assistant_reply': 'AI Assistant Reply',
    'manage_sub': 'Manage your poultry farm efficiently',
    'welcome_back_simple': 'Welcome back, {name}!',
    'welcome_app': 'Welcome to Poultry App',
    'manage_short': 'Manage your poultry farm efficiently',
    'onboard_desc_1': 'Manage your poultry farm efficiently and track your flock in real time.',
    'onboard_desc_2': 'Monitor growth, feed schedules, weight, and health records.',
    'onboard_desc_3': 'Access insights to improve egg and meat production on your farm.',
    'onboard_title_1': 'Welcome to Poultry App',
    'onboard_title_2': 'Track Your Flock',
    'onboard_title_3': 'Boost Production',
    'get_started': 'Get Started',
    'save_settings': 'Save Settings',
    'vaccination_title': 'Vaccination',
    'record_vaccination': 'Record Vaccination',
    'choose_flock': 'Choose flock',
    'select_vaccine': 'Select Vaccine',
    'choose_vaccine': 'Choose vaccine',
    'date_of_vaccination': 'Date of Vaccination',
    'next_vaccination_optional': 'Next Vaccination Date (Optional)',
    'notes_optional': 'Notes (Optional)',
    'add_remarks': 'Add remarks or observations',
    'please_select_flock_and_vaccine': 'Please select flock and vaccine',
    'save_vaccination': 'Save Vaccination',
    'vaccination_saved': 'Vaccination saved',
    'welcome_title': 'Welcome Back',
    'login_sub': 'Login to manage your poultry farm efficiently.',
    'login': 'Login',
    'logout': 'Logout',
    'forgot_password': 'Forgot Password?',
    'dont_have_account': "Don't have an account?",
    'register': 'Register',
    'create_account': 'Create Account',
    'signup_sub': 'Sign up to start managing your poultry farm.',
    'sign_up': 'Sign Up',
    'email_address': 'Email Address',
    'password': 'Password',
    'confirm_password': 'Confirm Password',
    'full_name': 'Full Name',
    'settings_title': 'Profile Settings',
    'farmer_name': 'Farmer Name',
    'farm_name': 'Farm Name',
    'preferences': 'Preferences',
    'enable_notifications': 'Enable Notifications',
    'security': 'Security',
    'change_app_pin': 'Change App PIN',
    'language': 'Language',
    'english': 'English',
    'swahili': 'Swahili',
    'save_success': 'Settings saved successfully',
    'notification_sounds': 'Notification Sounds',
    'sound_chime': 'Chime',
    'sound_bell': 'Bell',
    'sound_beep': 'Beep',
    'sound_melody': 'Melody',
    'sound_alarm': 'Alarm',
    'sound_note': 'Note',
    'account': 'Account',
    'not_signed_in': 'Not signed in',
    'image_not_found': 'Image not found',
    'notifications': 'Notifications',
    'notification_title': 'Title',
    'notification_body_optional': 'Body (optional)',
    'no_time_selected': 'No time selected',
    'pick': 'Pick',
    'schedule_reminder': 'Schedule Reminder',
    'reminder_scheduled': 'Reminder scheduled',
    'scheduled_reminders': 'Scheduled Reminders',
    'no_reminders': 'No reminders',
    'enter_title_and_schedule_time': 'Enter title and schedule time',
    'record_flock': 'Record Flock',
    'flock_details': 'Flock Details',
    'flock_name': 'Flock Name',
    'bird_type': 'Bird Type',
    'number_of_birds': 'Number of Birds',
    'average_age_weeks': 'Average Age (weeks)',
    'save_flock': 'Save Flock',
    'please_provide_flock_name_type_count': 'Please provide flock name, type and a valid count',
    'flock_saved': 'Flock saved',
    'delete_flock_title': 'Delete flock',
    'delete_flock_confirm': 'Are you sure you want to delete this flock?',
    'cancel': 'Cancel',
    'delete': 'Delete',
    'flock_deleted': 'Flock deleted',
    'type_label': 'Type: {value}',
    'count_label': 'Count: {value}',
    'avg_age_label': 'Avg age (weeks): {value}',
    'notes_label': 'Notes:',
    'recorded_label': 'Recorded: {value}',
    'close': 'Close',
    'poultry_details': 'Poultry Details',
    'no_flocks_recorded': 'No flocks recorded yet',
    'birds': 'birds',
    'total_birds': 'Total Birds',
    'mortality': 'Mortality',
    'mortality_with_flocks': 'Mortality ({count} flocks)',
    'mortality_tooltip': 'Tap to view mortality records',
    'eggs_today': 'Eggs Today',
    'feed_left': 'Feed Left',
    'farm_tools': 'Farm Tools',
    'record_mortality': 'Record Mortality',
    'record_eggs': 'Record Eggs',
    'feed_management': 'Feed Management',
    'feeding_programs': 'Feeding Programs',
    'manage_flocks': 'Manage Flocks',
    'poultry_info': 'Poultry Info',
    'vaccination_schedule': 'Vaccination Schedule',
    'marketplace': 'Marketplace',
    'growth_tracking': 'Growth Tracking',
    'tips': 'Tips',
    'tips_title': 'Tips & Advice',
    'general_tips_title': 'General Tips',
    'general_tips_bullets': 'Maintain clean drinking water for your birds daily.\nSeparate sick birds immediately to prevent disease spread.\nEnsure proper ventilation in poultry houses.\nProvide balanced feed according to bird age.\nRegularly check for parasites and vaccinate on schedule.',
    'ask_ai_personalized': 'Ask AI for Personalized Advice',
    'tip_hint_example': 'E.g. How to improve egg production this season?',
    'ai_tip_title': 'AI Tip',
    'save_tip': 'Save Tip',
    'dismiss': 'Dismiss',
    'tip_saved': 'Tip saved',
    'no_saved_tips': 'No saved tips yet',
    'tip_deleted': 'Tip deleted',
    'saved_tip': 'Saved Tip',
    'copied_to_clipboard': 'Copied to clipboard',
    'copy': 'Copy',
    'saved_tips': 'Saved Tips',
    'settings': 'Settings',
  },
  'sw': {
    'welcome_back_check': 'Karibu tena, {name}! Angalia hali ya shamba lako.',
    'tip_water': 'Vidokezo: Weka maji safi kwa ndege wenye afya.',
    'reminder_vaccination': 'Kumbusho: Kagua ratiba ya chanjo wiki hii.',
    'manage_sub': 'Sajili na simamia shamba lako la kuku kwa ufanisi',
    'welcome_back_simple': 'Karibu tena, {name}!',
    'welcome_app': 'Karibu kwenye App ya Kuku',
    'manage_short': 'Sajili na simamia shamba lako la kuku kwa ufanisi',
    'onboard_desc_1': 'Sajili na simamia shamba lako la kuku na fuatilia kundi lako kwa wakati halisi.',
    'onboard_desc_2': 'Fuatilia ukuaji, ratiba ya chakula, uzito, na rekodi za afya.',
    'onboard_desc_3': 'Pata maarifa kuongeza uzalishaji wa mayai na nyama kwenye shamba lako.',
    'onboard_title_1': 'Karibu kwenye App ya Kuku',
    'onboard_title_2': 'Fuatilia Kundi Lako',
    'onboard_title_3': 'Ongeza Uzalishaji',
    'get_started': 'Anza',
    'save_settings': 'Hifadhi Mipangilio',
    'vaccination_title': 'Chanjo',
    'record_vaccination': 'Rekodi Chanjo',
    'select_flock': 'Chagua Kundi',
    'choose_flock': 'Chagua kundi',
    'select_vaccine': 'Chagua Chanjo',
    'choose_vaccine': 'Chagua chanjo',
    'date_of_vaccination': 'Tarehe ya Chanjo',
    'next_vaccination_optional': 'Tarehe ya Chanjo Inayofuatia (Hiari)',
    'notes_optional': 'Maelezo (Hiari)',
    'add_remarks': 'Ongeza maoni au uchunguzi',
    'please_select_flock_and_vaccine': 'Tafadhali chagua kundi na chanjo',
    'save_vaccination': 'Hifadhi Chanjo',
    'vaccination_saved': 'Chanjo imetunzwa',
    'welcome_title': 'Karibu Tena',
    'login_sub': 'Ingia ili kusimamia shamba lako la kuku kwa ufanisi.',
    'login': 'Ingia',
    'logout': 'Toka',
    'forgot_password': 'Umesahau Nenosiri?',
    'dont_have_account': 'Huna akaunti?',
    'register': 'Jisajili',
    'create_account': 'Unda Akaunti',
    'signup_sub': 'Jisajili kuanza kusimamia shamba lako la kuku.',
    'sign_up': 'Jisajili',
    'email_address': 'Anwani ya Barua pepe',
    'password': 'Nenosiri',
    'confirm_password': 'Thibitisha Nenosiri',
    'full_name': 'Jina Kamili',
    'settings_title': 'Mipangilio ya Profaili',
    'farmer_name': 'Jina la Mkulima',
    'farm_name': 'Jina la Shamba',
    'preferences': 'Mapendeleo',
    'enable_notifications': 'Washa Arifa',
    'security': 'Usalama',
    'change_app_pin': 'Badilisha PIN ya App',
    'language': 'Lugha',
    'english': 'Kiingereza',
    'swahili': 'Kiswahili',
    'save_success': 'Mipangilio imetunzwa kikamilifu',
    'notification_sounds': 'Sauti za Arifa',
    'sound_chime': 'Chime',
    'sound_bell': 'Kengele',
    'sound_beep': 'Beep',
    'sound_melody': 'Melody',
    'sound_alarm': 'Alarm',
    'sound_note': 'Note',
    'account': 'Akaunti',
    'not_signed_in': 'Hujosajili',
    'notifications': 'Arifa',
    'notification_title': 'Kichwa',
    'notification_body_optional': 'Mwili (hiari)',
    'no_time_selected': 'Hakuna wakati ulioteuliwa',
    'pick': 'Chagua',
    'schedule_reminder': 'Panga Kumbusho',
    'reminder_scheduled': 'Kumbusho imepangiwa',
    'scheduled_reminders': 'Kumbusho Zilizopangwa',
    'no_reminders': 'Hakuna kumbusho',
    'enter_title_and_schedule_time': 'Weka kichwa na muda wa upangaji',
    'record_flock': 'Rekodi Kundi',
    'flock_details': 'Maelezo ya Kundi',
    'flock_name': 'Jina la Kundi',
    'bird_type': 'Aina ya Ndege',
    'number_of_birds': 'Idadi ya Ndege',
    'average_age_weeks': 'Umri wa Wastani (wiki)',
    'save_flock': 'Hifadhi Kundi',
    'please_provide_flock_name_type_count': 'Tafadhali toa jina la kundi, aina na idadi sahihi',
    'flock_saved': 'Kundi limetunzwa',
    'feed_management_title': 'Usimamizi wa Chakula',
    'ai_feeding_generator': 'Mjenzi wa Mpango wa Kula wa AI',
    'please_select_flock_feedtype_size': 'Tafadhali chagua kundi, aina ya chakula, na ingiza ukubwa wa kundi',
    'api_key_missing': 'API key haipo! Endesha na --dart-define=GROQ_API_KEY=...',
    'model_deprecated_msg': 'Mfano uliowekwa umetangazwa kutumika tena — kutumia mfano mbadala.',
    'please_enter_valid_flock_size_weight': 'Tafadhali ingiza ukubwa wa kundi na uzito wastani sahihi',
    'feeding_program_saved': 'Mpango wa kulea umehifadhiwa!',
    'enter_valid_stock_amount': 'Weka kiasi sahihi cha hisa',
    'stock_recorded': 'Hisa imehifadhiwa',
    'enter_valid_consumption': 'Weka matumizi sahihi',
    'consumption_recorded': 'Matumizi yamehifadhiwa',
    'feed_type': 'Aina ya Chakula',
    'choose_label': 'Chagua {label}',
    'flock_size_hint': 'Ukubwa wa Kundi (ndege)',
    'bird_age_hint': 'Umri wa Ndege (wiki)',
    'avg_weight_hint': 'Uzito Wastani (kg)',
    'generate_ai_program': 'Tengeneza Mpango wa AI',
    'generating': 'Inatengeneza...',
    'quick_feed_calculator': 'Kalkuleta ya Haraka ya Chakula',
    'save_program': 'Hifadhi Mpango',
    'save_stock': 'Hifadhi Hisa',
    'save_consumption': 'Hifadhi Matumizi',
    'quick_calculation': 'Mhesabu ya Haraka',
    'ai_feeding_program': 'Mpango wa Kula wa AI',
    'quick_feed_estimate': 'Makadirio ya Haraka ya Chakula:',
    'please_type_question': 'Tafadhali andika swali lako',
    'ai_busy_try_again': 'Msaidizi wa AI anashughulikia sasa. Tafadhali jaribu baadaye.',
    'no_internet_try_again': 'Hakuna muunganisho wa mtandao. Tafadhali angalia mtandao na ujaribu tena.',
    'general_tips_title': 'Vidokezo vya Jumla',
    'marketplace_title': 'Soko',
    'available_products': 'Bidhaa Zinazopatikana',
    'contact': 'Wasiliana',
    'contacting_seller': 'Kuwasiliana na muuzaji kwa {name}...',
    'ai_marketplace_title': 'Msaidizi wa Soko wa AI',
    'ai_marketplace_hint': 'Uliza kuhusu bei, wakati mzuri wa kuuza, usafirishaji, wanunuzi, au chochote!',
    'marketplace_hint_example': 'mfano: Ni bei gani nzuri kwa broilers mjini Nairobi leo?',
    'ai_assistant_reply': 'Jibu la Msaidizi wa AI',
    'delete_flock_title': 'Futa kundi',
    'delete_flock_confirm': 'Una hakika unataka kufuta kundi hili?',
    'cancel': 'Ghairi',
    'delete': 'Futa',
    'flock_deleted': 'Kundi limefutwa',
    'type_label': 'Aina: {value}',
    'count_label': 'Idadi: {value}',
    'avg_age_label': 'Umri wa wastani (wiki): {value}',
    'notes_label': 'Maelezo:',
    'recorded_label': 'Imerekodiwa: {value}',
    'close': 'Funga',
    'poultry_details': 'Maelezo ya Kuku',
    'no_flocks_recorded': 'Hakuna vikundi vilivyorekodiwa bado',
    'birds': 'ndege',
  }
};
